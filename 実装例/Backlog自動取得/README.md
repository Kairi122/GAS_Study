# **Backlog課題Googleスプレッドシート連携スクリプト**

## **概要**

このGoogle Apps Script（GAS）は、Backlogプロジェクトの課題を定期的に取得し、指定したGoogleスプレッドシートに同期するためのスクリプトです。  
新規課題の追加や既存課題のステータス更新を自動で行い、課題管理の可視化を支援します。

## **主な機能**

* 特定のBacklogプロジェクトから課題情報を取得  
* 課題の基本情報（ID, 課題キー, 件名, 完了予定日, ステータス）をシートに出力  
* カスタムフィールドの値をIDで指定して取得・出力  
* 実行時にシートを一度クリアし、最新の課題情報で完全に上書き  
* 「実施ステータス」列にステータスに応じた背景色を自動で設定  
* トリガーを設定することで、定期的に処理を自動実行可能

## **準備するもの**

1. **Googleアカウント**: GoogleスプレッドシートとGoogle Apps Scriptを利用できるアカウント  
2. **Backlogアカウント**:  
   * APIキー（個人設定から発行可能）  
   * 対象プロジェクトのプロジェクトID  
   * 取得したいカスタムフィールドのID

## **設定方法**

### **ステップ1：スプレッドシートの準備**

1. 新規にGoogleスプレッドシートを作成します。  
2. シートの下部にあるタブの名前を、スクリプトで指定する名前（デフォルトでは Backlog連携テスト）に変更します。

### **ステップ2：Google Apps Scriptの設定**

1. 準備したスプレッドシートで、メニューの「拡張機能」\>「Apps Script」を選択し、スクリプトエディタを開きます。  
2. エディタに表示されている初期コードをすべて削除し、提供された getBacklogIssues.gs のコードをすべて貼り付けます。  
3. スクリプト上部の「▼▼▼ 設定項目 ▼▼▼」セクションを、ご自身の環境に合わせて編集します。

| 定数名 | 説明 | 設定例 |
| :---- | :---- | :---- |
| SPACE\_URL | BacklogスペースのURLです。 | 'https://your-space.backlog.com' |
| API\_KEY | Backlogの個人設定から発行したAPIキー。 | 'abc...xyz' |
| PROJECT\_ID | 対象プロジェクトのID（数値）。 | 12345 |
| TARGET\_STATUS\_IDS | 取得したい課題のステータスIDの配列。\[\]（空配列）にすると完了済みを含む**全ての課題**を取得します。 | \[1, 2, 3\] |
| HEADERS | スプレッドシートに出力する列のヘッダー名。**この順番通りに出力されます。** | \["ID", "課題キー", ...\] |
| CUSTOM\_FIELD\_ID\_MAPPING | スプレッドシートの列名: カスタムフィールドのID の形式で設定します。 | {'サイト種別': 486225} |
| TARGET\_SHEET\_NAME | 操作対象のスプレッドシートのタブ名。 | 'Backlog連携テスト' |

4. ファイルを保存します（フロッピーディスクのアイコンをクリック）。

### **ステップ3：カスタムフィールドIDの取得方法（必要な場合）**

CUSTOM\_FIELD\_ID\_MAPPING に設定するIDが不明な場合は、以下の手順で確認できます。

1. スクリプトファイルに、一時的に以下の関数を追加します。  
   function getCustomFieldList() {  
     const projectId \= PROJECT\_ID;   
     const apiKey \= API\_KEY;  
     const spaceUrl \= SPACE\_URL;  
     const path \= \`/api/v2/projects/${projectId}/customFields\`;  
     const url \= \`${spaceUrl}${path}?apiKey=${apiKey}\`;  
     const response \= UrlFetchApp.fetch(url);  
     const customFields \= JSON.parse(response.getContentText());  
     customFields.forEach(field \=\> {  
       Logger.log(\`フィールド名: "${field.name}", ID: ${field.id}\`);  
     });  
   }

2. GASエディタ上部の関数選択メニューから getCustomFieldList を選び、「実行」ボタンをクリックします。  
3. 実行後、「実行ログ」にプロジェクトのカスタムフィールド名とIDの一覧が表示されるので、必要なIDを確認し、設定項目(6)に転記します。確認後はこの関数を削除して構いません。

### **ステップ4：初回実行と承認**

1. GASエディタ上部の関数選択メニューから syncBacklogIssues を選択します。  
2. 「▶ 実行」ボタンをクリックします。  
3. 初回実行時には「承認が必要です」というダイアログが表示されます。  
4. 「権限を確認」をクリックし、ご自身のGoogleアカウントを選択します。  
5. 「このアプリはGoogleで確認されていません」という画面が表示されたら、「詳細」をクリックし、「（プロジェクト名）（安全ではないページ）に移動」をクリックして、スクリプトの実行を許可します。

### **ステップ5：自動実行トリガーの設定**

スクリプトを定期的に自動実行するには、トリガーを設定します。

1. GASエディタの左側メニューから「トリガー」（時計のアイコン）をクリックします。  
2. 右下の「＋ トリガーを追加」ボタンをクリックします。  
3. 以下の通りに設定し、「保存」をクリックします。  
   * **実行する関数を選択**: syncBacklogIssues  
   * **実行するデプロイを選択**: Head  
   * **イベントのソースを選択**: 時間主導型  
   * **時間ベースのトリガーのタイプを選択**: 日タイマー  
   * **時刻を選択**: 毎日実行したい時刻（例: 午前8時～9時）

これで、毎日指定した時間にスクリプトが自動実行され、スプレッドシートが最新の状態に保たれます。