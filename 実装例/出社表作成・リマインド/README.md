

# **GASによる出社表自動生成＆Slack通知システム**

Google Apps Script（GAS）を利用して、Googleスプレッドシート上に従業員の出社表を自動で生成・管理し、毎日の出社予定をSlackに通知するシステムです。

## **📖 概要**

このシステムは、2つの主要なスクリプトで構成されています。

1. **出社表作成プログラム**:  
   * 毎月1日に自動で実行され、常に「今月」と「来月」の2ヶ月分のカレンダーを生成します。  
   * 古い月（先月分）の情報は自動で削除されるため、シートが重くなるのを防ぎます。  
   * 土日・祝日を自動で判定し、背景色を変更します。  
   * 従業員リストはスプレッドシートのA列で直接管理するため、コードを編集する必要がありません。  
2. **Slack通知プログラム**:  
   * 毎朝指定した時間に自動で実行されます。
   * その日の日付をスプレッドシートから探し出し、「出社」「有給」「研修」などのステータスが入力されている従業員の名前をリストアップします。
   * 指定したSlackチャンネルに、当日の出社予定者として通知します。

## **導入手順**

### **必要なもの**

* Googleアカウント
* Slackワークスペースと、通知を送信したいチャンネル

### **Step 1: スプレッドシートの準備**

1. 新しいGoogleスプレッドシートを作成します。
2. 左下のシート名を「**出社表**」に変更します。
3. メニューバーから「拡張機能」\>「**Apps Script**」を選択し、スクリプトエディタを開きます。

### **Step 2: 出社表作成スクリプトの設置**

1. スクリプトエディタで、デフォルトで表示されているコード（function myFunction() ...）をすべて削除します。
2. 【出社表作成プログラムのコード】をエディタに貼り付けます。
3. コード内の設定項目（STATUS\_OPTIONSなど）を必要に応じて編集します。
4. プロジェクトを保存します💾。

### **Step 3: Slack通知スクリプトの設置**

1. Slackで**Incoming Webhook URL**を取得します。
   1. 通知したいチャンネルの「インテグレーション」設定から「**Incoming Webhooks**」を追加します。
   2. 表示された**Webhook URL**をコピーしておきます。
2. スクリプトエディタの「ファイル」横の「+」から新しいスクリプトファイルを追加し、ファイル名（例: Slack通知）を設定します。
3. 【Slack通知プログラムのコード】を新しいファイルに貼り付けます。
4. コード冒頭の**設定項目を編集**します。
   * SLACK\_WEBHOOK\_URL: 先ほど取得したWebhook URLを貼り付けます。
   * SPREADSHEET\_ID: 出社表スプレッドシートのURLからID部分をコピーして貼り付けます。
   * SHEET\_NAME: スプレッドシートのシート名と一致していることを確認します。
5. プロジェクトを保存します💾。

### **Step 4: 初回実行と権限の承認**

1. **出社表作成スクリプト** (updateAttendanceSheet関数) を選択し、「実行」▶を押します。
   * 表示される指示に従い、Googleアカウントへのアクセス権限を承認します。
2. **Slack通知スクリプト** (notifyTodaysAttendanceToSlack関数) を選択し、「実行」▶を押します。
   * 同様に、外部サービスへの接続などの権限を承認します。

### **Step 5: 自動実行トリガーの設定**

スクリプトエディタの左メニュー⏰「トリガー」から、2つのトリガーをそれぞれ設定します。

1. **出社表更新用トリガー**
   * **実行する関数**: updateAttendanceSheet
   * **イベントのソース**: 時間主導型
   * **トリガーのタイプ**: 月タイマー
   * **日**: 1
   * **時刻**: 午前0時～1時
2. **Slack通知用トリガー**
   * **実行する関数**: notifyTodaysAttendanceToSlack
   * **イベントのソース**: 時間主導型
   * **トリガーのタイプ**: 日タイマー
   * **時刻**: 午前8時～9時 （通知したい任意の時間）

## **⚙️ 使い方と運用**

### **従業員の管理**

* **追加**: スプレッドシート「出社表」の**A列の末尾に名前を追加**します。
* **変更**: A列の従業員名を直接編集します。
* **削除**: A列から対象の行を削除します。

従業員情報を変更した後、次回の自動更新（毎月1日）を待つか、手動でupdateAttendanceSheetを実行すれば、変更が即座に反映されます。

### **出社状況の入力**

* 各日付のセルをクリックすると表示されるプルダウンから、 { "出社","休み","リモート","午後休","午前休", "有給", "研修" } などのステータスを選択します。

## **🔧 トラブルシューティング**

* **Slackに通知が届かない**
  1. **実行ログを確認する**: スクリプトエディタの📊「実行数」メニューから詳細ログを確認します。「通知対象者がいませんでした」と表示されている場合、その日の出社表に通知対象のステータスが入力されていないだけで、正常な動作です。
  2. **設定項目を見直す**: SLACK\_WEBHOOK\_URL, SPREADSHEET\_ID, SHEET\_NAMEに誤りや余計なスペースがないか確認してください。
  3. **Webhook URLのテスト**: 簡単なテスト用スクリプトでURL自体が有効かを確認します。
* **シートが更新されない**
  1. **トリガー設定を確認する**: updateAttendanceSheet関数のトリガーが正しく設定されているか確認してください。
  2. **実行権限**: 初回実行時の権限承認が正しく完了しているか確認してください。

---

